<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WorkWise Html Template</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="" />
<meta name="keywords" content="" />
<link rel="stylesheet" type="text/css" href="css/animate.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/line-awesome.css">
<link rel="stylesheet" type="text/css" href="css/line-awesome-font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="lib/slick/slick.css">
<link rel="stylesheet" type="text/css" href="lib/slick/slick-theme.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/responsive.css">
</head>


<body class="sign-in">
	

	<div class="wrapper">
		

		<div class="sign-in-page">
			<div class="signin-popup">
				<div class="signin-pop">
					<div class="row">
						<div class="col-lg-6">
							<div class="cmp-info">
								<div class="cm-logo">
									<img src="images/cm-logo.png" alt="">
									<p>键谈 一个用键盘畅所欲言的分享社区</p>
								</div><!--cm-logo end-->	
								<img src="images/cm-main-img.png" alt="">
							</div><!--cmp-info end-->
						</div>
						<div class="col-lg-6">
							<div class="login-sec">
								<ul class="sign-control">
									<li data-tab="tab-1" class="current"><a href="#" title="">登录</a></li>
									<li data-tab="tab-2"><a href="#" title="">注册</a></li>
								</ul>			
								<div class="sign_in_sec current" id="tab-1">
									
									<h3>登录</h3>
									<form>
										<div class="row">
											<div class="col-lg-12 no-pdd">
												<div class="sn-field">
													<input type="text" id="loginemail" placeholder="邮箱">
													<i class="la la-globe"></i>
												</div><!--sn-field end-->
											</div>
											<div class="col-lg-12 no-pdd">
												<div class="sn-field">
													<input type="password" id="loginpwd" placeholder="密码">
													<i class="la la-lock"></i>
												</div>
											</div>
											<div class="col-lg-12 no-pdd">
												<div class="checky-sec">
													<li><a class="post-jb active" href="#" title="">忘记密码</a></li>
												</div>
											</div>
											<div class="col-lg-12 no-pdd">
												<button type="button" value="submit" onclick="userlogin()">登录</button>
											</div>
										</div>
									</form>
								</div><!--sign_in_sec end-->
								<div class="sign_in_sec" id="tab-2">

									<div class="dff-tab current" id="tab-3">
										<form>
											<div class="row">
												<div class="col-lg-12 no-pdd">
													<div class="sn-field">
														<input type="text" name="nickname" id="nickname" placeholder="昵称">
														<i class="la la-user"></i>
													</div>
												</div>
												<div class="col-lg-12 no-pdd">
													<div class="sn-field">
														<input type="email" name="email" id="email" placeholder="邮箱">
														<i class="la la-globe"></i>
													</div>
												</div>
												<div class="col-lg-12 no-pdd">
													<div class="sn-field">
														<input type="number" name="phone" id="phone" placeholder="电话">
														<i class="la la-phone"></i>
													</div>
												</div>
												<div class="col-lg-12 no-pdd">
													<div class="sn-field">
														<input type="password" name="password" id="pass" placeholder="密码">
														<i class="la la-lock"></i>
													</div>
												</div>
												<div class="col-lg-12 no-pdd">
													<div class="sn-field">
														<input type="number" name="checkcode" id="checkcode"placeholder="*验证码*">
														<i class="la la-lock"></i>
													</div>
												</div>
												<div class="col-lg-12 no-pdd">
													<button type="button" value="checkcode" id="getcode">获取邮箱验证码</button><br>
													<button type="button" value="submit" onclick="userreg()">注册</button>
												</div>
											</div>
										</form>
									</div><!--dff-tab end-->

								</div>		
							</div><!--login-sec end-->
						</div>
					</div>		
				</div><!--signin-pop end-->
			</div><!--signin-popup end-->
			<div class="footy-sec">
				<div class="container">
					<ul>
						<li><a href="#" title="">管理员入口</a></li>
					</ul>
					<p><img src="images/copy-icon.png" alt="">Copyright 2019</p>
				</div>
			</div><!--footy-sec end-->
		</div><!--sign-in-page end-->
		<div class="post-popup job_post">
			<div class="post-project">
				<h3>找回密码</h3>
				<div class="post-project-fields">
					<form   method="post">
						<div class="row">
							<div class="col-lg-12">
								<input type="email" placeholder="输入你的邮箱" id="reemail">
							</div>
								<input type="number" placeholder="验证码" id="recode">
								<input type="password" placeholder="输入新密码" id="repass">
							<div class="col-lg-12">
								<ul>
									<li><button class="active" type="button" id="getrecode">获取验证码</button></li>
									<li><button class="active" type="button" value="post" onclick="userepwd()">修改密码</button></li>
								</ul>
							</div>
						</div>
					</form>
				</div><!--post-project-fields end-->


	</div><!--theme-layout end-->



<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/popper.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="lib/slick/slick.min.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript">
	$("#getcode").click(function (){
		sendchkcode($("#getcode"));
	});
	$("#getrecode").click(function (){
		sendrechkcode($("#getrecode"));
	});
	//用ajax提交到后台的发送接口
	function sendchkcode(obj){
		//setTime(obj);//开始倒计时
		var email = $("#email").val();
		var result = isEmail();
		if(result) {
			$.ajax({
				url:"/getcheckcode",
				data:{email:email},
				dataType:"json",
				type:"post",
				async : false,
				cache : false,
				success:function(res){
					debugger;
					if(res){
						alert("验证码发送成功");
					}else{

					}
				},
				error:function(){
					alert("验证码发送失败");
				}
			})
			setTime(obj);//开始倒计时
		}
	}
	//忘记密码
	function sendrechkcode(obj){
		var email = $("#reemail").val();
		if(isreEmail()) {
			$.ajax({
				url:"/getrecode",
				data:{email:email},
				dataType:"text",
				type:"post",
				async : false,
				cache : false,
				success:function(res){
					debugger;
					if(res!=null && res=="ok"){
						alert("验证码发送成功");
					}else{
						alert("不存在此邮箱的账户");
					}
				},
				error:function(){
					alert("验证码发送失败");
				}
			})
			setTime(obj);//开始倒计时
		}
	}
		//用户注册
		function userreg() {
		var email = $("#email").val();
		var ccode=$("#checkcode").val();
		var nickname=$("#nickname").val();
		var phone=$("#phone").val();
		var pass=$("#pass").val();
		if(isEmail()&&isNick()&&isPass()&&isPhone()) {
			$.ajax({
				url: "/userreg",
				data: {
					email: email,
					ccode: ccode,
					nickname: nickname,
					phone: phone,
					pass: pass
				},
				dataType: "text",
				type: "post",
				async: false,
				cache: false,
				success: function (res) {
					debugger;
					if (res == "ok" && res != null) {
						alert("！-注册成功-！")
					} else if(res == "bad" && res != null){
						alert("该邮箱已经被注册");
					}else {
						alert("验证码错误");
					}
				},
				error: function () {
					alert("失败");
				}
			})
		}

	}
	//用户修改密码
	function userepwd() {
		var email = $("#reemail").val();
		var ccode=$("#recode").val();
		var pass=$("#repass").val();
		if(pass.length!=0) {
			$.ajax({
				url: "/userchangepwd",
				data: {
					email: email,
					ccode: ccode,
					pass: pass
				},
				dataType: "text",
				type: "post",
				async: false,
				cache: false,
				success: function (res) {
					debugger;
					if (res == "ok" && res != null) {
						alert("修改成功")
						window.location.href="/user";
					} else if(res == "bad" && res != null){
						alert("验证码错误");
					}else {
						alert("验证码错误");
					}
				},
				error: function () {
					alert("失败");
				}
			})
		}else {
			alert("密码不能为空");
		}

	}
	//用户登录
	function userlogin() {
		var email=$("#loginemail").val();
		var pass=$("#loginpwd").val();
		if(isLoginEmail(email)&&isLoginPass(pass))
		{
			$.ajax({
				url: "/userlogin",
				data: {
					email: email,
					pass: pass
				},
				dataType: "text",
				type: "post",
				async: false,
				cache: false,
				success: function (res) {
					debugger;

					if (res == "ok" && res != null) {
						alert("登录成功");
							window.location.href="/toindex?email="+email;
					}else {
						alert("账号密码错误");
					}
				},
				error: function () {
					alert("哇哦，出错失败了");
				}
			})
		}


	}

	//30s倒计时实现逻辑
	var countdown = 30;
	function setTime(obj) {
		if (countdown == 0) {
			obj.prop('disabled', false);
			obj.text("点击获取验证码");
			countdown = 30;//30秒过后button上的文字初始化,计时器初始化;
			return;
		} else {
			obj.prop('disabled', true);
			obj.text("("+countdown+"s)后重新发送") ;
			countdown--;
		}
		setTimeout(function() { setTime(obj) },1000) //每1000毫秒执行一次
	}

	function isPhone(){
		var phonenum = $("#phone").val();
		var reg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
		if(!reg.test(phonenum)){
			alert('请输入有效的手机号码！');
			return false;
		}else{
			return true;
		}
	}
	function isEmail() {
		var email = $("#email").val();
		var reg = /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;
		if(!reg.test(email))
		{
			alert('输入正确的邮箱');
			return false;
		}else {
			return true;
		}
	}
	function isreEmail() {
		var email = $("#reemail").val();
		var reg = /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;
		if(!reg.test(email))
		{
			alert('输入正确的邮箱');
			return false;
		}else {
			return true;
		}

	}
	function isLoginEmail() {
		var email = $("#loginemail").val();
		var reg = /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;
		if(!reg.test(email))
		{
			alert('输入正确的邮箱');
			return false;
		}else {
			return true;
		}
	}
	function isNick() {
		var nickname=$("#nickname").val();
		if(nickname==null)
		{
			alert('昵称不能为空')
			return false;
		}else {
		return true;}
	}
	function isPass() {
		var pass=$("#pass").val();
		if(pass==null)
		{
			alert('密码不能为空')
			return false;
		}else
		{return true;
		}
	}
	function isLoginPass() {
		var pass=$("#loginpwd").val();
		if(pass==null)
		{
			alert('密码不能为空')
			return false;
		}else
		{return true;
		}
	}


</script>
</body>
</html>
