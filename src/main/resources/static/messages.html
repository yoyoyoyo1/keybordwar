<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
<<<<<<< HEAD
<meta charset="UTF-8">
<title>WorkWise Html Template</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="" />
<meta name="keywords" content="" />
<link rel="stylesheet" type="text/css" href="css/animate.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/line-awesome.css">
<link rel="stylesheet" type="text/css" href="css/line-awesome-font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" type="text/css" href="lib/slick/slick.css">
<link rel="stylesheet" type="text/css" href="lib/slick/slick-theme.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/responsive.css">
	<style>
		.audio {
			position: relative;
			margin-right: 6px;
			max-width: 116px;
			min-width: 30px;
			height: 24px;
			line-height: 24px;
			padding: 0 4px 0 10px;
			border-radius: 2px;
			color: #000;
			text-align: right;
			background-color: rgba(107, 197, 107, 0.85);
=======
	<meta charset="UTF-8">
	<title>WorkWise Html Template</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<link rel="stylesheet" type="text/css" href="css/animate.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/line-awesome.css">
	<link rel="stylesheet" type="text/css" href="css/line-awesome-font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="css/jquery.mCustomScrollbar.min.css">
	<link rel="stylesheet" type="text/css" href="lib/slick/slick.css">
	<link rel="stylesheet" type="text/css" href="lib/slick/slick-theme.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" type="text/css" href="css/responsive.css">
	<style type="text/css">
		.toolbar {
			border: 1px solid #ccc;
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a
		}

		.audio {
			text-align: left;
		}

		.audio:before {
			position: absolute;
			right: -8px;
			top: 8px;
			content: '';
			display: inline-block;
			width: 0;
			height: 0;
			border-style: solid;
			border-width: 4px;
			border-color: transparent transparent transparent rgba(107, 197, 107, 0.85);
		}
		.left:before{
			left: -8px;
			border-color: transparent rgba(107, 197, 107, 0.85) transparent transparent;
		}

		.audio span {
			color: rgba(255, 255, 255, .8);
			display: inline-block;
			transform-origin: center;
		}


		@keyframes wink {
			from {
				color: rgba(255, 255, 255, .8);
			}
			to {
				color: rgba(255, 255, 255, .1);
			}
		}

		.audio .span-right:nth-child(1) {
			font-weight: 400;
		}
		.audio .span-right:nth-child(2) {
			transform: scale(0.8);
			font-weight: 500;
		}
		.audio .span-right:nth-child(3) {
			transform: scale(0.5);
			font-weight: 700;
		}

		.audio .span-left:nth-child(1) {
			transform: scale(0.5);
			font-weight: 700;
		}

		.audio .span-left:nth-child(2) {
			transform: scale(0.8);
			font-weight: 500;
		}
		.audio .span-left:nth-child(3) {
			font-weight: 400;
		}

		.audio.wink span {
			animation: wink 1s ease infinite;
		}

		.duration {
			margin: 3px 2px;
		}
	</style>
</head>


<body>
<<<<<<< HEAD
	

	<div id="app" class="wrapper">



		<header>
			<div class="container">
				<div class="header-data">
					<div class="logo">
						<a href="index.html" title=""><img src="images/logo.png" alt=""></a>
					</div><!--logo end-->
					<div class="search-bar">
						<form>
							<input type="text" name="search" placeholder="Search...">
							<button type="submit"><i class="la la-search"></i></button>
						</form>
					</div><!--search-bar end-->
					<nav>
						<ul>
							<li>
								<a href="index" title="">
									<span><img src="images/icon1.png" alt=""></span>
									首页
								</a>
							</li>
							<li>
								<a href="dialoging.html" title="">
									<span><img src="images/icon2.png" alt=""></span>
									圆桌话题
								</a>
							</li>
							<li>
								<a href="profiles.html" title="">
									<span><img src="images/icon4.png" alt=""></span>
									关注的人
								</a>
								<ul>
									<li><a href="user-profile.html" title="">User Profile</a></li>
									<li><a href="my-profile-feed.html" title="">my-profile-feed</a></li>
								</ul>
							</li>
							<li>
								<a href="messages.html" title="" class="not-box-open">
									<span><img src="images/icon6.png" alt=""></span>
									私信
								</a>
								<div class="notification-box msg">
							<div class="nt-title">
								<h4>Setting</h4>
								<a href="#" title="">Clear all</a>
							</div>
							<div class="nott-list">
								<div class="notfication-details">
									<div class="noty-user-img">
										<img src="images/resources/ny-img1.png" alt="">
									</div>
									<div class="notification-info">
										<h3><a href="messages.html" title="">Jassica William</a> </h3>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do.</p>
										<span>2 min ago</span>
									</div><!--notification-info -->
=======


<div id="app" class="wrapper">



	<header>
		<div class="container">
			<div class="header-data">
				<div class="logo">
					<a href="index.html" title=""><img src="images/logo.png" alt=""></a>
				</div><!--logo end-->
				<div class="search-bar">
					<form>
						<input type="text" name="search" placeholder="Search...">
						<button type="submit"><i class="la la-search"></i></button>
					</form>
				</div><!--search-bar end-->
				<nav>
					<ul>
						<li>
							<a href="index" title="">
								<span><img src="images/icon1.png" alt=""></span>
								首页
							</a>
						</li>
						<li>
							<a href="dialoging.html" title="">
								<span><img src="images/icon2.png" alt=""></span>
								圆桌话题
							</a>
						</li>
						<li>
							<a href="profiles.html" title="">
								<span><img src="images/icon4.png" alt=""></span>
								关注的人
							</a>
							<ul>
								<li><a href="user-profile.html" title="">User Profile</a></li>
								<li><a href="my-profile-feed.html" title="">my-profile-feed</a></li>
							</ul>
						</li>
						<li>
							<a href="#" title="" class="not-box-open">
								<span><img src="images/icon6.png" alt=""></span>
								私信
							</a>
							<div class="notification-box msg">
								<div class="nt-title">
									<h4>Setting</h4>
									<a href="#" title="">Clear all</a>
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a
								</div>
								<div class="nott-list">
									<div class="notfication-details">
										<div class="noty-user-img">
											<img src="images/resources/ny-img1.png" alt="">
										</div>
										<div class="notification-info">
											<h3><a href="messages.html" title="">Jassica William</a> </h3>
											<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do.</p>
											<span>2 min ago</span>
										</div><!--notification-info -->
									</div>
									<div class="view-all-nots">
										<a href="messages.html" title="">View All Messsages</a>
									</div>
								</div><!--nott-list end-->
							</div><!--notification-box end-->
						</li>
						<li>
							<a href="#" title="" class="not-box-open">
								<span><img src="images/icon7.png" alt=""></span>
								Notification
							</a>
							<div class="notification-box">
								<div class="nt-title">
									<h4>Setting</h4>
									<a href="#" title="">Clear all</a>
								</div>
								<div class="nott-list">
									<div class="notfication-details">
										<div class="noty-user-img">
											<img src="images/resources/ny-img1.png" alt="">
										</div>
										<div class="notification-info">
											<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
											<span>2 min ago</span>
										</div><!--notification-info -->
									</div>
									<div class="notfication-details">
										<div class="noty-user-img">
											<img src="images/resources/ny-img2.png" alt="">
										</div>
										<div class="notification-info">
											<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
											<span>2 min ago</span>
										</div><!--notification-info -->
									</div>
									<div class="notfication-details">
										<div class="noty-user-img">
											<img src="images/resources/ny-img3.png" alt="">
										</div>
										<div class="notification-info">
											<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
											<span>2 min ago</span>
										</div><!--notification-info -->
									</div>
<<<<<<< HEAD
								</li>
							</ul>
							<h3>Custom Status</h3>
							<div class="search_form">
								<form>
									<input type="text" name="search">
									<button type="submit">Ok</button>
								</form>
							</div><!--search_form end-->
							<h3>Setting</h3>
							<ul class="us-links">
								<li><a href="profile-account-setting.html" title="">Account Setting</a></li>
								<li><a href="#" title="">Privacy</a></li>
								<li><a href="#" title="">Faqs</a></li>
								<li><a href="#" title="">Terms & Conditions</a></li>
							</ul>
							<h3 class="tc"><a href="#" title="">Logout</a></h3>
						</div><!--user-account-settingss end-->
					</div>
				</div><!--header-data end-->
			</div>
		</header><!--header end-->	



		<section class="messages-page">
			<div class="container">
				<div class="messages-sec">
					<div class="row">
						<div class="col-lg-4 col-md-12 no-pdd">
							<div class="msgs-list">
								<div class="msg-title">
									<h3>私聊列表</h3>
								</div><!--msg-title end-->
								<div class="messages-list">
									<ul>
										<li>最近联系</li>
										<li :class="toId==people.id?'active':''" @click="changeTo($event,people.id)" v-for="(people,index) in latelyTalk">
											<room-people :user="people"></room-people>
										</li>
										<li>互相关注</li>
										<li :class="toId==people.id?'active':''" @click="changeTo($event,people.id)" v-for="(people,index) in eachOther">
											<room-people :user="people"></room-people>
										</li>
									</ul>
								</div><!--messages-list end-->
							</div><!--msgs-list end-->
						</div>
						<div class="col-lg-8 col-md-12 pd-right-none pd-left-none">
							<div class="main-conversation-box">
								<div class="message-bar-head">
									<div class="usr-msg-details">
										<div class="usr-ms-img">
											<img src="images/ic6.png" alt="">
=======
									<div class="notfication-details">
										<div class="noty-user-img">
											<img src="images/resources/ny-img2.png" alt="">
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a
										</div>
										<div class="notification-info">
											<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
											<span>2 min ago</span>
										</div><!--notification-info -->
									</div>
									<div class="view-all-nots">
										<a href="#" title="">View All Notification</a>
									</div>
<<<<<<< HEAD
									<a href="#" title=""><i class="fa fa-ellipsis-v"></i></a>
								</div><!--message-bar-head end-->
								<div style="overflow: auto;" class="messages-line-1">
									<room-message :message="message" v-for="(message,index) in roomMessage.message">
									</room-message>
								</div><!--messages-line end-->
									<div class="message-send-area">
										<form>
											<div class="mf-field">
												<input id="message" type="text" name="message" placeholder="Type a message here">
												<button @click="send" type="button">Send</button>
											</div>
											<ul  id="emoji" style="display: none; position: absolute; bottom:50px; background-color:#fff; padding: 10px">
												<li @click="checkEmoji(item)" style=" margin: 5px;" v-for="(item,index) in emoji">
													{{item}}
												</li>
											</ul>
											<ul>
												<li @click="showEmoji" ><i class="fa fa-smile-o"></i></li>
												<li ><i @mouseup="closeMedia" @mousedown="requestMediaAccess" class="fa fa-microphone"></i></li>
												<li><i @click="checkImage" class="fa fa-camera-retro">  </i></li>
												<input @change="imageUpdate($event)" accept="image/gif, image/jpeg, image/png"  type="file" style="display: none"  id="imageFile">
											</ul>
										</form>
                                            </div><!--message-send-area end-->

							</div><!--main-conversation-box end-->
						</div>
=======
								</div><!--nott-list end-->
							</div><!--notification-box end-->
						</li>
					</ul>
				</nav><!--nav end-->
				<div class="menu-btn">
					<a href="#" title=""><i class="fa fa-bars"></i></a>
				</div><!--menu-btn end-->
				<div class="user-account">
					<div class="user-info">
						<img src="images/resources/user.png" alt="">
						<a href="#" title="">John</a>
						<i class="la la-sort-down"></i>
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a
					</div>
					<div class="user-account-settingss">
						<h3>Online Status</h3>
						<ul class="on-off-status">
							<li>
								<div class="fgt-sec">
									<input type="radio" name="cc" id="c5">
									<label for="c5">
										<span></span>
									</label>
									<small>Online</small>
								</div>
							</li>
							<li>
								<div class="fgt-sec">
									<input type="radio" name="cc" id="c6">
									<label for="c6">
										<span></span>
									</label>
									<small>Offline</small>
								</div>
							</li>
						</ul>
						<h3>Custom Status</h3>
						<div class="search_form">
							<form>
								<input type="text" name="search">
								<button type="submit">Ok</button>
							</form>
						</div><!--search_form end-->
						<h3>Setting</h3>
						<ul class="us-links">
							<li><a href="profile-account-setting.html" title="">Account Setting</a></li>
							<li><a href="#" title="">Privacy</a></li>
							<li><a href="#" title="">Faqs</a></li>
							<li><a href="#" title="">Terms & Conditions</a></li>
						</ul>
						<h3 class="tc"><a href="#" title="">Logout</a></h3>
					</div><!--user-account-settingss end-->
				</div>
			</div><!--header-data end-->
		</div>
	</header><!--header end-->



	<section class="messages-page">
		<div class="container">
			<div class="messages-sec">
				<div class="row">
					<div class="col-lg-4 col-md-12 no-pdd">
						<div class="msgs-list">
							<div class="msg-title">
								<h3>私聊列表</h3>
							</div><!--msg-title end-->
							<div class="messages-list">
								<ul>
									<li>最近联系</li>
									<li :class="toId==people.id?'active':''" @click="changeTo($event,people.id)" v-for="(people,index) in latelyTalk">
										<room-people :user="people"></room-people>
									</li>
									<li>互相关注</li>
									<li :class="toId==people.id?'active':''" @click="changeTo($event,people.id)" v-for="(people,index) in eachOther">
										<room-people :user="people"></room-people>
									</li>
								</ul>
							</div><!--messages-list end-->
						</div><!--msgs-list end-->
					</div>
				<div class="col-lg-8 col-md-12 pd-right-none pd-left-none">
					<div class="main-conversation-box">
						<div class="message-bar-head">
							<div class="usr-msg-details">
								<div class="usr-ms-img">
									<img src="images/ic6.png" alt="">
								</div>
								<div class="usr-mg-info">
									<h3><span></span></h3>
								</div><!--usr-mg-info end-->
							</div>
							<a href="#" title=""><i class="fa fa-ellipsis-v"></i></a>
						</div><!--message-bar-head end-->
						<div style="overflow: auto;" class="messages-line-1">
							<room-message :message="message" v-for="(message,index) in roomMessage.message">
							</room-message>
						</div><!--messages-line-1 end-->
						<div class="message-send-area">
							<form>
								<div class="mf-field">
									<input id="message" type="text" name="message" placeholder="Type a message here">
									<button @click="send" type="button">Send</button>
								</div>
								<ul  id="emoji" style="display: none; position: absolute; bottom:50px; background-color:#fff; padding: 10px">
									<li @click="checkEmoji(item)" style=" margin: 5px;" v-for="(item,index) in emoji">
										{{item}}
									</li>
								</ul>
								<ul>
									<li @click="showEmoji" ><i class="fa fa-smile-o"></i></li>
									<li><i class="fa fa-camera"></i></li>
									<li><i class="fa fa-paperclip"></i></li>
								</ul>
							</form>
						</div><!--message-send-area end-->

					</div><!--main-conversation-box end-->
				</div>
			</div>
		</div><!--messages-sec end-->
</div>
</section><!--messages-page end-->



<footer>
	<div class="footy-sec mn no-margin">
		<div class="container">
			<ul>
				<li><a href="#" title="">Help Center</a></li>
				<li><a href="#" title="">Privacy Policy</a></li>
				<li><a href="#" title="">Community Guidelines</a></li>
				<li><a href="#" title="">Cookies Policy</a></li>
				<li><a href="#" title="">Career</a></li>
				<li><a href="#" title="">Forum</a></li>
				<li><a href="#" title="">language</a></li>
				<li><a href="#" title="">Copyright Policy</a></li>
			</ul>
			<p><img src="images/copy-icon2.png" alt="">Copyright 2017</p>
			<img class="fl-rgt" src="images/logo2.png" alt="">
		</div>
	</div>
</footer>

<<<<<<< HEAD
	</div><!--theme-layout end-->
	<audio src="" id="audio"></audio>
=======
</div><!--theme-layout end-->

>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a


<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/popper.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.mCustomScrollbar.js"></script>
<script type="text/javascript" src="lib/slick/slick.min.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript" src="js/socket.js"></script>
</body>
</html>
<script src="js/vue.min.js"></script>
<script src="js/axios.min.js"></script>
<script type="text/x-template" id="room-people">
	<div class="usr-msg-details">
		<div class="usr-ms-img">
			<img :src="'userimage/' + user.image" alt="">
			<span class="msg-status"></span>
		</div>
		<div class="usr-mg-info">
			<h3>{{user.nickname}}</h3>
		</div><!--usr-mg-info end-->
		<!--<span class="msg-notifc">1</span>-->
	</div><!--usr-msg-details end-->
</script>

<script type="text/x-template" id="room-message">
	{{own.id}}
	<other-message v-if="own.id != message.formId" :message="message"></other-message>
	<me-message v-else :message="message"></me-message>
</script>

<script type="text/x-template" id="other-message">
	<div class="main-message-box ta-right">
		<div class="message-dt ">
			<div class="message-inner-dt">
				<p v-if="message.type=='text'">{{message.content}}</p>
				<div  v-else-if="message.type === 'audio'" @click="Play($event,message.content)" class="audio" style="width: 40px; float:right">
					<span class="span-left">(</span>
					<span class="span-left">(</span>
					<span class="span-left">(</span>
				</div>
				<p v-else>
					<img :src="'/audio/'+message.content" alt="">
				</p>
			</div><!--message-inner-dt end-->
			<span>{{message.createAt}}</span>
		</div><!--message-dt end-->
		<div class="messg-usr-img">
			<img :src="'userimage/' + people[message.toId].image" alt="">
		</div><!--messg-usr-img end-->
	</div><!--main-message-box end-->

</script>
<script type="text/x-template" id="me-message">
	<div class="main-message-box st3">
		<div class="message-dt st3">
			<div class="message-inner-dt">
				<p v-if="message.type=='text'">{{message.content}}</p>
				<div  v-else-if="message.type === 'audio'" @click="Play($event,message.content)" class="audio left" style="width: 40px; float: left">
					<span class="span">)</span>
					<span class="span">)</span>
					<span class="span">)</span>
				</div>
				<p v-else>
					<img :src="'/audio/'+message.content" alt="">
				</p>
			</div><!--message-inner-dt end-->
			<span>{{message.createAt}}</span>
		</div><!--message-dt end-->
		<div class="messg-usr-img">
			<img :src=" 'userimage/' + people[message.formId].image" alt="">
		</div><!--messg-usr-img end-->
	</div><!--main-message-box end-->
</script>
<script>
    let audio = document.getElementById("audio")
    audio.onended = function () {
        let winks = document.getElementsByClassName("wink")
        for(wink of winks){
            if(wink.className.indexOf("left")!=-1){
                wink.className = " left "
            }else {
                wink.className = ""
            }
            wink.className += " audio "
        }
    }
    let emoji = ["😀","😁","😂","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘",
        "😗","😙","😚","😇","😐","😑","😶","😏","😣","😥","😮","😯","😪","😫","😴",
        "😌","😛","😜","😝","😒","😓","😔","😕","😲","😷","😖","😞","😟","😤","😢",
        "😭","😦","😧","😨","😬","😰","😱","😳","😵","😡","😠", "🌹","🍀","🍎","💰"
        ,"📱","🌙","🍁","🍂","🍃","🌷","💎","🔪","🔫","🏀","⚽","⚡","👄","👍","🔥"]
    let people = {}
    let eachOther = []
	let latelyTalk = []
    let message = {}
    let roomMessage = {time:0,message:[]}
    let own = {}
    let toId = 1
	let chunk=[]
    Vue.component('room-people',{
        //定义数据
        props:['user'],
        data:function () {
            return{
                own
            }
        },
        //定义方法
        methods:{

        },
        template:'#room-people'

    })
    Vue.component('room-message',{
        //定义数据
        props:['message'],
        data:function () {
            return{
                people,
                own
            }
        },
        //定义方法
        methods:{

        },
        template:'#room-message'

    })
    Vue.component('other-message',{
        //定义数据
        props:['message'],
        data:function () {
            return{
                people
            }
        },
        //定义方法
        methods:{
            Play(e,content){
                let audio = document.getElementById("audio")
                console.log(content)
                audio.src = "/audio/"+content;
                audio.play()
                let a = event.currentTarget
                audio.onplaying = function () {
                    let winks = document.getElementsByClassName("wink")
                    for(wink of winks){
                        if(wink.className.indexOf("left")!=-1){
                            wink.className = " left "
                        }else {
                            wink.className = ""
                        }
                        wink.className += " audio "

                    }
                    a.className += " wink "
                }

            }
        },
        template:'#other-message'

    })
    //定义我发的消息组件
    Vue.component('me-message',{
        //定义数据
        props:['message'],
        data:function () {
            return{
                people
            }
        },
        //定义方法
        methods:{
            Play(event,content){
                let audio = document.getElementById("audio")
                console.log(content)
                audio.src = "/audio/"+content;
                audio.play()
                let a = event.currentTarget
                audio.onplaying = function () {
                    let winks = document.getElementsByClassName("wink")
                    for(wink of winks){
                        if(wink.className.indexOf("left")!=-1){
                            wink.className = " left "
                        }else {
                            wink.className = ""
                        }
                        wink.className += " audio "

                    }
                    a.className += " wink "
                }
            }
        },
        template:'#me-message'

    })
    new Vue({
        el: '#app',
        data: {
            people,
            latelyTalk,
            eachOther,
            message,
            roomMessage,
            toId,
            emoji,
            audioUrl:"",
            recorder:"",
            ws:"",
        },
        methods:{
            dataURLtoBlob(dataurl) {
                var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1]
                var bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n)
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return new Blob([u8arr], { type: mime });
            },
            compress(image){
                var canvas = document.createElement('canvas');
                var context = canvas.getContext('2d');
                // 图片原始尺寸
                var originWidth = image.width;
                var originHeight = image.height;
                // 最大尺寸限制，可通过设置宽高来实现图片压缩程度
                var maxWidth = 300,
                    maxHeight = 300;
                // 目标尺寸
                var targetWidth = originWidth,
                    targetHeight = originHeight;
                // 图片尺寸超过300x300的限制
                if(originWidth > maxWidth || originHeight > maxHeight) {
                    if(originWidth / originHeight > maxWidth / maxHeight) {
                        // 更宽，按照宽度限定尺寸
                        targetWidth = maxWidth;
                        targetHeight = Math.round(maxWidth * (originHeight / originWidth));
                    } else {
                        targetHeight = maxHeight;
                        targetWidth = Math.round(maxHeight * (originWidth / originHeight));
                    }
                }
                // canvas对图片进行缩放
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                // 清除画布
                context.clearRect(0, 0, targetWidth, targetHeight);
                // 图片压缩
                context.drawImage(image, 0, 0, targetWidth, targetHeight);
                /*第一个参数是创建的img对象；第二三个参数是左上角坐标，后面两个是画布区域宽高*/
                var dataurl  = canvas.toDataURL('image/jpeg', 0.92);//base64 格式
                var blob = this.dataURLtoBlob(dataurl);
                return blob;
            },
            checkImage(){
                document.getElementById("imageFile").click()
            },
            imageUpdate(event){
                let file = event.currentTarget.files[0];
                let freader = new FileReader();
                freader.readAsDataURL(file);
                freader.onload = (e) => {
                    document.getElementById("imageFile").value = "" // 清除路径
                    var image = new Image();
                    image.src= freader.result;
                    image.onload=()=>{
                        var blob = this.compress(image)
                        const formData = new FormData()
                        formData.append('file', blob, new Date().getTime()+'.jpg')

                        axios({
                            method: 'post',
                            url: '/api/video/upload',
                            data: formData,
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        }).then(res => {
                            this.ws.send({content:res.data,toId:this.toId,type:"image"})
                        }).catch(err => {
                            console.log('上传失败！')
                        })
                    };
                };
            },
            closeMedia(){
                this.recorder.stop()
            },
            saveRecordingData() {
                let blob = new Blob(chunk, { 'type': 'audio/ogg; codecs=opus' }),
                    audioStream = URL.createObjectURL(blob),
                    //估算时长
                    duration = parseInt(blob.size / 6600);
                if (duration <= 0) {
                    alert('说话时间太短');
                    return;
                }
                if (duration > 60) {
                    duration = 60;
                }
                chunk = [];
                const formData = new FormData()
                formData.append('file', blob, new Date().getTime()+'.ogg')
                axios({
                    method: 'post',
                    url: '/api/video/upload',
                    data: formData,
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                }).then(res => {
                    this.ws.send({content:res.data,toId:this.toId,type:"audio"})
                }).catch(err => {
                    console.log('上传失败！')
                })
            },
            checkEmoji(item){
                document.getElementById('emoji').style.display = 'none'
                document.getElementById('message').value += item
            },
            showEmoji(){
                document.getElementById('emoji').style.display = 'block'
            },
            send(){
                let str = document.getElementById("message").value
                document.getElementById("message").value = ""
                toId=this.toId
                this.ws.ws.send(JSON.stringify({content:str,type:"text",toId}))
            },
            changeTo(e,to){
                document.getElementsByClassName("active")[0].className = ""
                e.currentTarget.className = 'active'
                this.toId = to;

<<<<<<< HEAD
			},
            getRecordingData(e) {
                //录制的数据
                chunk.push(e.data)
            },

            requestMediaAccess() {

                navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                    //创建媒体录制对象
                    recorder = new window.MediaRecorder(stream);
                    recorder.start(0)
                    this.recorder = recorder
                    recorder.ondataavailable = this.getRecordingData;
                    recorder.onstop = this.saveRecordingData;
                    console.log("开始记录")
                }, error => {
                    alert('出错，请确保已允许浏览器获取录音权限');
                });
            },
=======
            }
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a

        },
        mounted(){
            //得到自己
            axios.get("/user/self").then((res)=>{
                own = res.data
<<<<<<< HEAD
				people[own.id] = own
                this.ws = new WS(`wss://localhost:8080/websocket/${own.id}`)
                //获取历史信息
				axios.get(`/privatechat/history/message?formId=${own.id}&toId=${toId}`).then((res)=>{
                    if(!res.data){
                        console.log(res.data)
					}
					for(item of res.data){
                        roomMessage.message.push(item)
					}
				})
=======
                people[own.id] = own
                this.ws = new WS(`wss://localhost:8080/websocket/${own.id}`)
                //获取历史信息
                axios.get(`privatechat/history/message?formId=${own.id}&toId=${toId}`).then((res)=>{
                    if(!res.data){
                        console.log(res.data)
                        return
                    }
                    for(item of res.data){
                        roomMessage.message.push(item)
                    }
                })
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a
            })
            axios.get("/privatechat/user/latelyTalk").then((res)=>{
                if(res.data[0]){
                    this.toId = res.data[0].id
<<<<<<< HEAD
				}
=======
                }
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a

                for (let user of res.data) {
                    if (user) {
                        latelyTalk.push(user)
                        this.people[user.id] = user
                    }
                }
<<<<<<< HEAD
			})
			axios.get("/privatechat/user/eachother").then((res)=>{
                if(!this.toId&&res.data[0]){
                    this.toId = res.data[0].id
				}
                for (let user of res.data) {
                    if (user) {
                        eachOther.push(user)
                        this.people[user.id] = user
                    }
=======
                localStorage.setItem("people",JSON.stringify("people"))
            })
            axios.get("/privatechat/user/eachother").then((res)=>{
                if(!this.toId&&res.data[0]){
                    this.toId = res.data[0].id
>>>>>>> 0c06d3367b42a048346238e71bf958fa652e038a
                }

                for (let user of res.data) {
                    if (user) {
                        eachOther.push(user)
                        this.people[user.id] = user
                    }
                }
            })

        }
    })

</script>