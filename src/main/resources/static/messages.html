<!DOCTYPE html>
<!--suppress ALL -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>WorkWise Html Template</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="" />
<meta name="keywords" content="" />
<link rel="stylesheet" type="text/css" href="css/animate.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/line-awesome.css">
<link rel="stylesheet" type="text/css" href="css/line-awesome-font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" type="text/css" href="lib/slick/slick.css">
<link rel="stylesheet" type="text/css" href="lib/slick/slick-theme.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/responsive.css">
	<style type="text/css">
		.toolbar {
			border: 1px solid #ccc;
		}
		.text {
			border: 1px solid #ccc;
			height: 400px;
		}
	</style>
</head>


<body>
	

	<div id="app" class="wrapper">



		<header>
			<div class="container">
				<div class="header-data">
					<div class="logo">
						<a href="index.html" title=""><img src="images/logo.png" alt=""></a>
					</div><!--logo end-->
					<div class="search-bar">
						<form>
							<input type="text" name="search" placeholder="Search...">
							<button type="submit"><i class="la la-search"></i></button>
						</form>
					</div><!--search-bar end-->
					<nav>
						<ul>
							<li>
								<a href="index.html" title="">
									<span><img src="images/icon1.png" alt=""></span>
									首页
								</a>
							</li>
							<li>
								<a href="dialoging.html" title="">
									<span><img src="images/icon2.png" alt=""></span>
									圆桌话题
								</a>
							</li>
							<li>
								<a href="profiles.html" title="">
									<span><img src="images/icon4.png" alt=""></span>
									关注的人
								</a>
								<ul>
									<li><a href="user-profile.html" title="">User Profile</a></li>
									<li><a href="my-profile-feed.html" title="">my-profile-feed</a></li>
								</ul>
							</li>
							<li>
								<a href="#" title="" class="not-box-open">
									<span><img src="images/icon6.png" alt=""></span>
									私信
								</a>
								<div class="notification-box msg">
							<div class="nt-title">
								<h4>Setting</h4>
								<a href="#" title="">Clear all</a>
							</div>
							<div class="nott-list">
								<div class="notfication-details">
									<div class="noty-user-img">
										<img src="images/resources/ny-img1.png" alt="">
									</div>
									<div class="notification-info">
										<h3><a href="messages.html" title="">Jassica William</a> </h3>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do.</p>
										<span>2 min ago</span>
									</div><!--notification-info -->
								</div>
								<div class="view-all-nots">
									<a href="messages.html" title="">View All Messsages</a>
								</div>
							</div><!--nott-list end-->
						</div><!--notification-box end-->
							</li>
							<li>
								<a href="#" title="" class="not-box-open">
									<span><img src="images/icon7.png" alt=""></span>
									Notification
								</a>
								<div class="notification-box">
									<div class="nt-title">
										<h4>Setting</h4>
										<a href="#" title="">Clear all</a>
									</div>
									<div class="nott-list">
										<div class="notfication-details">
							  				<div class="noty-user-img">
							  					<img src="images/resources/ny-img1.png" alt="">
							  				</div>
							  				<div class="notification-info">
							  					<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
							  					<span>2 min ago</span>
							  				</div><!--notification-info -->
						  				</div>
						  				<div class="notfication-details">
							  				<div class="noty-user-img">
							  					<img src="images/resources/ny-img2.png" alt="">
							  				</div>
							  				<div class="notification-info">
							  					<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
							  					<span>2 min ago</span>
							  				</div><!--notification-info -->
						  				</div>
						  				<div class="notfication-details">
							  				<div class="noty-user-img">
							  					<img src="images/resources/ny-img3.png" alt="">
							  				</div>
							  				<div class="notification-info">
							  					<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
							  					<span>2 min ago</span>
							  				</div><!--notification-info -->
						  				</div>
						  				<div class="notfication-details">
							  				<div class="noty-user-img">
							  					<img src="images/resources/ny-img2.png" alt="">
							  				</div>
							  				<div class="notification-info">
							  					<h3><a href="#" title="">Jassica William</a> Comment on your project.</h3>
							  					<span>2 min ago</span>
							  				</div><!--notification-info -->
						  				</div>
						  				<div class="view-all-nots">
						  					<a href="#" title="">View All Notification</a>
						  				</div>
									</div><!--nott-list end-->
								</div><!--notification-box end-->
							</li>
						</ul>
					</nav><!--nav end-->
					<div class="menu-btn">
						<a href="#" title=""><i class="fa fa-bars"></i></a>
					</div><!--menu-btn end-->
					<div class="user-account">
						<div class="user-info">
							<img src="images/resources/user.png" alt="">
							<a href="#" title="">John</a>
							<i class="la la-sort-down"></i>
						</div>
						<div class="user-account-settingss">
							<h3>Online Status</h3>
							<ul class="on-off-status">
								<li>
									<div class="fgt-sec">
										<input type="radio" name="cc" id="c5">
										<label for="c5">
											<span></span>
										</label>
										<small>Online</small>
									</div>
								</li>
								<li>
									<div class="fgt-sec">
										<input type="radio" name="cc" id="c6">
										<label for="c6">
											<span></span>
										</label>
										<small>Offline</small>
									</div>
								</li>
							</ul>
							<h3>Custom Status</h3>
							<div class="search_form">
								<form>
									<input type="text" name="search">
									<button type="submit">Ok</button>
								</form>
							</div><!--search_form end-->
							<h3>Setting</h3>
							<ul class="us-links">
								<li><a href="profile-account-setting.html" title="">Account Setting</a></li>
								<li><a href="#" title="">Privacy</a></li>
								<li><a href="#" title="">Faqs</a></li>
								<li><a href="#" title="">Terms & Conditions</a></li>
							</ul>
							<h3 class="tc"><a href="#" title="">Logout</a></h3>
						</div><!--user-account-settingss end-->
					</div>
				</div><!--header-data end-->
			</div>
		</header><!--header end-->	



		<section class="messages-page">
			<div class="container">
				<div class="messages-sec">
					<div class="row">
						<div class="col-lg-4 col-md-12 no-pdd">
							<div class="msgs-list">
								<div class="msg-title">
									<h3>私聊列表</h3>
								</div><!--msg-title end-->
								<div class="messages-list">
									<ul>
										<li :class="toId==people.id?'active':''" @click="changeTo($event,people.id)" v-for="(people,index) in latelyTalk">
											<room-people :user="people"></room-people>
										</li>
										<li @click="changeTo($event,people.id)" v-for="(people,index) in eachOther">
											<room-people :user="people"></room-people>
										</li>
									</ul>
								</div><!--messages-list end-->
							</div><!--msgs-list end-->
						</div>
						<div class="col-lg-8 col-md-12 pd-right-none pd-left-none">
							<div class="main-conversation-box">
								<div class="message-bar-head">
									<div class="usr-msg-details">
										<div class="usr-ms-img">
											<img src="images/ic6.png" alt="">
										</div>
										<div class="usr-mg-info">
											<h3><span></span></h3>
										</div><!--usr-mg-info end-->
									</div>
									<a href="#" title=""><i class="fa fa-ellipsis-v"></i></a>
								</div><!--message-bar-head end-->
								<div style="overflow: auto;" class="messages-line">
									<room-message :message="message" v-for="(message,index) in roomMessage.message">
									</room-message>
								</div><!--messages-line end-->
									<div class="message-send-area">
										<form>
											<div class="mf-field">
												<input id="message" type="text" name="message" placeholder="Type a message here">
												<button @click="send" type="button">Send</button>
											</div>
											<ul  id="emoji" style="display: none; position: absolute; bottom:50px; background-color:#fff; padding: 10px">
												<li @click="checkEmoji(item)" style=" margin: 5px;" v-for="(item,index) in emoji">
													{{item}}
												</li>
											</ul>
											<ul>
												<li @click="showEmoji" ><i class="fa fa-smile-o"></i></li>
												<li><i class="fa fa-camera"></i></li>
												<li><i class="fa fa-paperclip"></i></li>
											</ul>
										</form>
                                            </div><!--message-send-area end-->

							</div><!--main-conversation-box end-->
						</div>
					</div>
				</div><!--messages-sec end-->
			</div>
		</section><!--messages-page end-->



		<footer>
			<div class="footy-sec mn no-margin">
				<div class="container">
					<ul>
						<li><a href="#" title="">Help Center</a></li>
						<li><a href="#" title="">Privacy Policy</a></li>
						<li><a href="#" title="">Community Guidelines</a></li>
						<li><a href="#" title="">Cookies Policy</a></li>
						<li><a href="#" title="">Career</a></li>
						<li><a href="#" title="">Forum</a></li>
						<li><a href="#" title="">language</a></li>
						<li><a href="#" title="">Copyright Policy</a></li>
					</ul>
					<p><img src="images/copy-icon2.png" alt="">Copyright 2017</p>
					<img class="fl-rgt" src="images/logo2.png" alt="">
				</div>
			</div>
		</footer>

	</div><!--theme-layout end-->



<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/popper.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.mCustomScrollbar.js"></script>
<script type="text/javascript" src="lib/slick/slick.min.js"></script>
<!--<script type="text/javascript" src="js/scrollbar.js"></script>-->
<script type="text/javascript" src="js/script.js"></script>
<!--<script type="text/javascript" th:inline="javascript">
    var ctx = [[${#request.getContextPath()}]];
</script>-->
<!--	<script th:src="@{/js/socketChart.js}"></script>-->
<script type="text/javascript" src="js/socket.js"></script>
</body>
</html>
<script src="js/vue.min.js"></script>
<script src="js/axios.min.js"></script>
<script type="text/x-template" id="room-people">
	<div class="usr-msg-details">
		<div class="usr-ms-img">
			<img :src="'userimage/' + user.image" alt="">
			<span class="msg-status"></span>
		</div>
		<div class="usr-mg-info">
			<h3>{{user.nickname}}</h3>
		</div><!--usr-mg-info end-->
		<!--<span class="msg-notifc">1</span>-->
	</div><!--usr-msg-details end-->
</script>

<script type="text/x-template" id="room-message">
	{{own.id}}
	<other-message v-if="own.id != message.formId" :message="message"></other-message>
	<me-message v-else :message="message"></me-message>
</script>

<script type="text/x-template" id="other-message">
	<div class="main-message-box ta-right">
		<div class="message-dt ">
			<div class="message-inner-dt">
				<p>{{message.content}}</p>
			</div><!--message-inner-dt end-->
			<span>{{message.createAt}}</span>
		</div><!--message-dt end-->
		<div class="messg-usr-img">
			<img :src="'userimage/' + people[message.toId].image" alt="">
		</div><!--messg-usr-img end-->
	</div><!--main-message-box end-->

</script>
<script type="text/x-template" id="me-message">
	<div class="main-message-box st3">
		<div class="message-dt st3">
			<div class="message-inner-dt">
				<p>{{message.content}}</p>
			</div><!--message-inner-dt end-->
			<span>{{message.createAt}}</span>
		</div><!--message-dt end-->
		<div class="messg-usr-img">
			<img :src=" 'userimage/' + people[message.formId].image" alt="">
		</div><!--messg-usr-img end-->
	</div><!--main-message-box end-->

</script>
<script>
    let emoji = ["😀","😁","😂","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘",
        "😗","😙","😚","😇","😐","😑","😶","😏","😣","😥","😮","😯","😪","😫","😴",
        "😌","😛","😜","😝","😒","😓","😔","😕","😲","😷","😖","😞","😟","😤","😢",
        "😭","😦","😧","😨","😬","😰","😱","😳","😵","😡","😠", "🌹","🍀","🍎","💰"
        ,"📱","🌙","🍁","🍂","🍃","🌷","💎","🔪","🔫","🏀","⚽","⚡","👄","👍","🔥"]
    let people = {}
    let eachOther = []
	let latelyTalk = []
    let message = {content:"123",createAt:new Date(),formId:1}
    let roomMessage = {time:0,message:[]}
    let own = {}
    let dialogId = parseInt(localStorage.getItem("dialogId"));
    let toId = 0;
    Vue.component('room-people',{
        //定义数据
        props:['user'],
        data:function () {
            return{
                own
            }
        },
        //定义方法
        methods:{

        },
        template:'#room-people'

    })
    Vue.component('room-message',{
        //定义数据
        props:['message'],
        data:function () {
            return{
                people,
                own
            }
        },
        //定义方法
        methods:{

        },
        template:'#room-message'

    })
    Vue.component('other-message',{
        //定义数据
        props:['message'],
        data:function () {
            return{
                people
            }
        },
        //定义方法
        methods:{

        },
        template:'#other-message'

    })
    //定义我发的消息组件
    Vue.component('me-message',{
        //定义数据
        props:['message'],
        data:function () {
            return{
                people
            }
        },
        //定义方法
        methods:{

        },
        template:'#me-message'

    })
    new Vue({
        el: '#app',
        data: {
            people,
            latelyTalk,
            eachOther,
            message,
            roomMessage,
			toId,
            emoji,
            ws:"",
        },
        methods:{
            checkEmoji(item){
                document.getElementById('emoji').style.display = 'none'
                document.getElementById('message').value += item
            },
            showEmoji(){
                document.getElementById('emoji').style.display = 'block'
            },
            send(){
                let str = document.getElementById("message").value
                document.getElementById("message").value = ""
                toId=this.toId
                this.ws.ws.send(JSON.stringify({str,toId}))
            },
            changeTo(e,to){
                document.getElementsByClassName("active")[0].className = ""
                e.currentTarget.className = 'active'
                this.toId = to;

			}

        },
        mounted(){
            //得到people
            if(JSON.parse(localStorage.getItem("people"))){
                people = JSON.parse(localStorage.getItem("people"))
            }

            //得到自己
            axios.get("/user/self").then((res)=>{
                own = res.data
				people[own.id] = own
                this.ws = new WS(`ws://localhost:8080/websocket/${own.id}`)
                //获取历史信息
            })
			axios.get("/privatechat/user/latelyTalk").then((res)=>{
                this.toId = res.data[0].id
                for (let user of res.data){
                    latelyTalk.push(user)
                    this.people[user.id] = user
				}
			})
			axios.get("/privatechat/user/eachother").then((res)=>{
                for (let user of res.data){
                    eachOther.push(user)
                    this.people[user.id] = user
                }
			})

        }
    })

</script>